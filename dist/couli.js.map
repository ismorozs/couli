{"version":3,"sources":["webpack://Couli/webpack/bootstrap","webpack://Couli/./src/helpers/checkers.js","webpack://Couli/./src/globals/attributes.js","webpack://Couli/./src/helpers/object.js","webpack://Couli/./src/helpers/dom.js","webpack://Couli/./src/helpers/common.js","webpack://Couli/./src/State.js","webpack://Couli/./src/Definition.js","webpack://Couli/./src/View.js","webpack://Couli/./src/main.js","webpack://Couli/./src/globals/regexp.js","webpack://Couli/./src/errors/ComponentNotExistsError.js","webpack://Couli/./src/helpers/copy.js","webpack://Couli/./src/helpers/equality.js","webpack://Couli/./src/errors/StateAccessError.js","webpack://Couli/./src/errors/StateLookupError.js","webpack://Couli/./src/errors/BindingNotExistsError.js","webpack://Couli/./src/errors/ComponentRedefineError.js","webpack://Couli/./src/errors/ScopeNameCollisionError.js","webpack://Couli/./src/Production.js","webpack://Couli/./src/EventHandler.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","isArray","obj","getObjectType","isObject","isObjectInBrackets","length","isString","toString","isFunction","isObjectInDoubleBrackets","isHTMLString","indexOf","isNumber","isDOMElement","tagName","isUndefined","isEmpty","keys","isLink","slashIdx","some","idx","PREFIX","LIB_NAME","TEMPLATE_BINDING","TEMPLATE_LIST_BINDING","BINDING_ID","ATTR_PREFIX","STATE_PATH","TEMPLATE_PLACEMENT","STATE_NAME","SCOPE_PREFIX","ITEM_INDEX","COMPONENT_TYPE","ITEM_SUFFIX","STATE_DELIMITER","BASE","COMPONENT","LIST","ITEM","SELF","FULL_CHANGE","_checkers","path","set","assign","dest","remove","addConstFields","fields","_loop","field","Error","forEach","cb","prop","map","newObj","mapKeys","newKey","filter","toObject","arr","val","v","replaceNodes","original","replacement","parentNode","replaceChild","cloneHTMLMarkup","markup","markupStr","trim","document","querySelector","innerHTML","div","createElement","children","collectHTMLNodes","root","isWanted","nodes","push","childNodes","walkNodes","allNodes","filteredNodes","node","removeNode","removeChild","insertBeforeNode","el","nextEl","insertBefore","_object","has","getFalsePaths","onlyFalsePaths","getFalsePath","concat","toDashCase","str","replace","match","toLowerCase","toCamelCase","toUpperCase","getShortName","NAMES","real","shortName","short","getRealName","num","_common","_View","componentOpts","id","ELEMENT_COUNTER","element","ELEMENTS","state","component","STATE","setupValueNodesForComponents","applyChanges","_defineProperty","LIB_ATTR","setAttribute","createAccessor","getOnlyValues","startTransaction","changes","CHANGES","collecting","commitChanges","VALUE_TYPES","statePath","values","accessor","valuesNode","valuesNodes","binding","bindingName","valueNode","isList","reduce","a","initValue","isComponent","isListItem","createValuesNode","listItemName","_analyzePath","analyzePath","up","level","newStatePath","lastIdx","slice","StateLookupError","moveUpStatePath","down","additionalPath","changeObj","setValues","prepareChangeObject","getValues","els","modifyArray","start","unshift","add","pop","shift","raw","modifyToArrayAccessor","forced","type","force","lifeCycleHandlers","renderChanges","h","false","changeValues","calledDependences","details","end","change","changesForValue","aliases","realChangeValues","links","link","keysEquality","_equality2","default","splice","setValueForList","setValueForComponent","equal","html","dependants","dependant","dependantKey","dependantBinding","newValue","evaluate","setValue","apply","bindingValues","action","args","addToArray","vals","removeFromArray","window","_dom","_State","REACTIVE_FUNCS_TYPES","DEFAULT_HOOKS","define","bindings","hooks","styles","COMPONENTS","ComponentRedefineError","componentHTMLMarkup","classList","COMPONENT_COUNTER","stateId","stateNames","gatherBindingsFromMarkup","HTMLNodes","analyzeBinding","HTMLNode","bindingOpts","createBinding","setComponent","removeAttribute","modifyToListBinding","normalizedOptions","normalizeUserOptions","optionsObj","parentKey","parentObj","class","option","listeners","events","RESERVED_BINDING_NAMES","basicBinding","_copy2","prepareBindings","currentStateId","parentComponent","componentWrapper","appendChild","subComponents","oldBindingId","newBindingId","shortId","shortenBindingId","bindingNode","prepareReactiveFuncs","listItemComponent","listItem","k","setupComponentsLinks","template","cloneNode","subComponent","createAndAppendStyles","getComponentOpts","componentBinding","subComponentOpts","stateName","ScopeNameCollisionError","_links","revLinks","componentData","reactiveFunc","func","funcParams","funcStrWithoutComments","RE","STRIP_COMMENTS","ARGUMENT_NAMES","getParamNames","valuesObjRegExp","RegExp","dependenciesNames","funcStr","dependencyName","exec","getDependenciesNames","valuesObj","this","compute","prepareReactiveFunc","getAttribute","ComponentNotExistsError","getComponentByName","Array","attributes","attr","innerLink","elOpts","itemMarkup","split","join","styleObj","componentName","styleStr","selector","normalizeStyles","styleEl","createTextNode","head","console","log","LIFE_CYCLE_HANDLERS","list","componentChanges","elementId","componentId","componentAccessor","applyMarkup","render","classes","className","style","attrs","renderList","updateComponent","drawComponent","renderComponent","itemWrapper","renderFunc","renderType","firstBinding","childStatePath","childMarkup","mount","itemIndex","itemAccessor","componentMarkup","statePathToBinding","changeType","update","listComponent","itemsValues","listBinding","listNode","removedCount","itemChanges","statePathToItem","fixIndexes","listFragment","buildList","updateList","nextNode","nextElementSibling","range","createDocumentFragment","itemValue","newItemIndex","listItemMarkup","diff","itemNode","newIdx","_Definition","_Production","_classCallCheck","_this","_possibleConstructorReturn","__proto__","getPrototypeOf","message","copy","destination","source","copyArray","checkKeysEquality","first","second","childNode","StateAccessError","additionalInfo","BindingNotExistsError","_EventHandler","rootElementSelector","rootElement","setupEventHandlers","setupElement","getStatePathToItem","indexlessStatePath","curEl","elType","eventHandlers","gatherAllEventHandlers","gatheredHandlers","eventName","gatherEventHandlers","addEventListener","e","stopPropagation","propagationStopped","decorateEvent","curHTMLNode","target","bindingId","eventHandler","accessorToData","executeAllCallbacksInList"],"mappings":"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","file":"couli.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n","export {\r\n  isFunction,\r\n  isArray,\r\n  isObject,\r\n  isObjectInBrackets,\r\n  isObjectInDoubleBrackets,\r\n  isString,\r\n  isHTMLString,\r\n  isNumber,\r\n  isDOMElement,\r\n  isUndefined,\r\n  isEmpty,\r\n  isLink,\r\n};\r\n\r\n\r\nfunction isFunction(obj) {\r\n  return getObjectType(obj) === '[object Function]';\r\n}\r\n\r\nfunction isArray (obj) {\r\n  return getObjectType(obj) === '[object Array]';\r\n}\r\n\r\nfunction isObject (obj) {\r\n  return getObjectType(obj) === '[object Object]';\r\n}\r\n\r\nfunction isObjectInBrackets (obj) {\r\n  return isArray(obj) && obj.length === 1 && isObject(obj[0]);\r\n}\r\n\r\nfunction isObjectInDoubleBrackets (obj) {\r\n  return isArray(obj) && obj.length === 1 && isObjectInBrackets(obj[0]);\r\n}\r\n\r\nfunction isString (obj) {\r\n  return getObjectType(obj) === '[object String]';\r\n}\r\n\r\nfunction isHTMLString (obj) {\r\n  return isString(obj) && obj.indexOf('<') === 0;\r\n}\r\n\r\nfunction isNumber (obj) {\r\n  return getObjectType(obj) === '[object Number]' && obj === obj;\r\n}\r\n\r\nfunction isDOMElement (obj) {\r\n  return obj && typeof obj.tagName !== 'undefined';\r\n}\r\n\r\nfunction isUndefined (obj) {\r\n  return typeof obj === 'undefined';\r\n}\r\n\r\nfunction getObjectType (obj) {\r\n  return Object.prototype.toString.call(obj);\r\n}\r\n\r\nfunction isLink (obj) {\r\n  const slashIdx = obj.indexOf('/');\r\n  return [0, 1, 2].some((idx) => idx === slashIdx);\r\n}\r\n\r\nfunction isEmpty (obj) {\r\n  if (!obj) {\r\n    return true;\r\n  }\r\n\r\n  if (isArray(obj) || isString(obj)) {\r\n    return !obj.length;\r\n  }\r\n\r\n  return !Object.keys(obj).length;\r\n}\r\n","const LIB_NAME = 'x';\r\nconst ATTR_PREFIX = 'data-';\r\nconst PREFIX = LIB_NAME + '-';\r\nconst TEMPLATE_BINDING = PREFIX + 'b';\r\nconst TEMPLATE_LIST_BINDING = PREFIX + 'lb';\r\nconst BINDING_ID = ATTR_PREFIX + PREFIX + 'id';\r\nconst STATE_PATH = PREFIX + 'spath';\r\nconst TEMPLATE_PLACEMENT = PREFIX + 'el';\r\nconst STATE_NAME = PREFIX + 'state-name';\r\nconst SCOPE_PREFIX = 's';\r\nconst ITEM_INDEX = ATTR_PREFIX + PREFIX + 'dx';\r\nconst COMPONENT_TYPE = ATTR_PREFIX + PREFIX + 'tp';\r\nconst ITEM_SUFFIX = 'i';\r\nconst STATE_DELIMITER = '-';\r\nconst SELF = ' _self_ ';\r\nconst FULL_CHANGE = ' _full_change_ ';\r\n\r\nconst BASE = '1';\r\nconst COMPONENT = '2';\r\nconst LIST = '3';\r\nconst ITEM = '4';\r\n\r\nexport default {\r\n  PREFIX,\r\n  TEMPLATE_BINDING,\r\n  TEMPLATE_LIST_BINDING,\r\n  BINDING_ID,\r\n  STATE_PATH,\r\n  TEMPLATE_PLACEMENT,\r\n  STATE_NAME,\r\n  SCOPE_PREFIX,\r\n  ITEM_INDEX,\r\n  COMPONENT_TYPE,\r\n  ITEM_SUFFIX,\r\n  STATE_DELIMITER,\r\n  BASE,\r\n  COMPONENT,\r\n  LIST,\r\n  ITEM,\r\n  SELF,\r\n  FULL_CHANGE,\r\n};\r\n","import {\r\n  isObject,\r\n  isFunction,\r\n} from './checkers';\r\n\r\nexport {\r\n  get,\r\n  set,\r\n  remove,\r\n  addConstFields,\r\n  forEach,\r\n  map,\r\n  mapKeys,\r\n  filter,\r\n  toObject,\r\n};\r\n\r\nfunction get (obj, path) {\r\n  let value = obj;\r\n  for (let i = 0; i < path.length; i++) {\r\n    value = value[path[i]];\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction set (obj, path, value) {\r\n  if (!path.length) {\r\n    if (isObject(value)) {\r\n      return Object.assign(obj, value);\r\n    }\r\n    return obj = value;\r\n  }\r\n\r\n  let dest = obj;\r\n  for (var i = 0; i < path.length - 1; i++) {\r\n    if (!dest[ path[i] ]) {\r\n      dest = dest[path[i]] = {};\r\n    } else {\r\n      dest = dest[path[i]];\r\n    }\r\n  }\r\n\r\n  if (isObject(value)) {\r\n    dest[ path[i] ] = dest[ path[i] ] || {};\r\n    Object.assign(dest[ path[i] ], value);\r\n  } else {\r\n    dest[ path[i] ] = value;\r\n  }\r\n\r\n  return obj;\r\n}\r\n\r\nfunction remove (obj, path) {\r\n  let value = obj;\r\n  for (var i = 0; i < path.length - 1; i++) {\r\n    value = value[path[i]];\r\n  }\r\n\r\n  delete value[path[i]];\r\n}\r\n\r\nfunction addConstFields (obj, fields) {\r\n  for (let field in fields) {\r\n    Object.defineProperty(obj, field, {\r\n      get: function () { return fields[field] },\r\n      set: function () { throw new Error(\"Trying to redefine const field '\" + field + \"'\") },\r\n    })\r\n  }\r\n}\r\n\r\nfunction forEach (obj, cb) {\r\n  for (let key in obj) {\r\n    const prop = obj[key];\r\n    cb(prop, key, obj);\r\n  }\r\n}\r\n\r\nfunction map(obj, cb) {\r\n  const newObj = {}\r\n  for (let key in obj) {\r\n    const prop = obj[key];\r\n    newObj[key] = cb(prop, key, obj);\r\n  }\r\n  return newObj;\r\n}\r\n\r\nfunction mapKeys (obj, cb) {\r\n  const newObj = {}\r\n  for (let key in obj) {\r\n    const prop = obj[key];\r\n    const newKey = cb(key, prop, obj);\r\n    newObj[newKey] = prop;\r\n  }\r\n  return newObj;\r\n}\r\n\r\nfunction filter (obj, cb) {\r\n  const newObj = {};\r\n  for (let key in obj) {\r\n    const prop = obj[key];\r\n    if ( cb(prop, key, obj) ) {\r\n      newObj[key] = prop;\r\n    }\r\n  }\r\n  return newObj;\r\n}\r\n\r\nfunction toObject (arr, val) {\r\n  const newObj = {};\r\n  arr.forEach((v) => {\r\n    newObj[v] = isFunction(val) ? val(v) : val;\r\n  });\r\n  return newObj;\r\n}\r\n","import LIB_ATTR from '../globals/attributes';\r\n\r\nimport {\r\n  isArray,\r\n  isHTMLString,\r\n  isDOMElement,\r\n} from './checkers';\r\n\r\nimport ComponentNotExistsError from '../errors/ComponentNotExistsError';\r\n\r\nconst COMPONENTS = {};\r\n\r\nexport {\r\n  replaceNodes,\r\n  cloneHTMLMarkup,\r\n  collectHTMLNodes,\r\n  removeNode,\r\n  insertBeforeNode,\r\n};\r\n\r\nfunction replaceNodes (original, replacement) {\r\n  original.parentNode.replaceChild(replacement, original);\r\n  return replacement;\r\n}\r\n\r\nfunction insertBeforeNode (el, nextEl) {\r\n  nextEl.parentNode.insertBefore(el, nextEl);\r\n}\r\n\r\nfunction cloneHTMLMarkup (markup) {\r\n  const markupStr = isHTMLString(markup.trim()) ? markup : document.querySelector(markup).innerHTML;\r\n\r\n  const div = document.createElement('div');\r\n  div.innerHTML = markupStr;\r\n  return div.children[0];\r\n}\r\n\r\nfunction collectHTMLNodes (root, isWanted) {\r\n  const nodes = [];\r\n\r\n  if (isWanted(root)) {\r\n    nodes.push(root);\r\n  }\r\n\r\n  if (root.childNodes) {\r\n    walkNodes (root.childNodes, isWanted, nodes);\r\n  }\r\n\r\n  return nodes;\r\n};\r\n\r\nfunction walkNodes (allNodes, isWanted, filteredNodes) {\r\n allNodes.forEach((node) => {\r\n    if (isWanted(node)) {\r\n      filteredNodes.push(node);\r\n    }\r\n\r\n    if (node.childNodes) {\r\n      walkNodes (node.childNodes, isWanted, filteredNodes);\r\n    }\r\n  });\r\n}\r\n\r\nfunction removeNode (node) {\r\n  node.parentNode.removeChild(node);\r\n}\r\n","import { isObject } from './checkers';\r\nimport { set } from './object';\r\n\r\nexport {\r\n  has,\r\n  getFalsePaths,\r\n  toDashCase,\r\n  toCamelCase,\r\n  getShortName,\r\n  getRealName,\r\n};\r\n\r\nconst NAMES = {\r\n  real: {},\r\n  short: []\r\n};\r\n\r\nfunction getShortName (name) {\r\n  if (NAMES.real[name]) {\r\n    return NAMES.real[name];\r\n  }\r\n\r\n  const shortName = NAMES.short.push(name);\r\n  return NAMES.real[name] = shortName - 1;\r\n}\r\n\r\nfunction getRealName (num) {\r\n  return NAMES.short[num];\r\n}\r\n\r\nfunction has (obj, el) {\r\n  if (isObject(obj)) {\r\n    const keys = Object.keys(obj);\r\n    return has(keys, el);\r\n  }\r\n\r\n  return obj.indexOf(el) >= 0;\r\n};\r\n\r\nfunction getFalsePaths (obj) {\r\n  const onlyFalsePaths = {};\r\n  getFalsePath(obj, onlyFalsePaths, []);\r\n  return onlyFalsePaths;\r\n}\r\n\r\nfunction getFalsePath (obj, onlyFalsePaths, path) {\r\n  for (let key in obj) {\r\n    if (isObject(obj[key])) {\r\n      getFalsePath(obj[key], onlyFalsePaths, path.concat(key));\r\n      continue;\r\n    }\r\n\r\n    if (obj[key] !== true) {\r\n      set(onlyFalsePaths, path.concat(key), obj[key]);\r\n    }\r\n  }\r\n}\r\n\r\nfunction toDashCase (str) {\r\n  return str.replace(/([A-Z])/g, (match) => '-' + match[0].toLowerCase());\r\n}\r\n\r\nfunction toCamelCase (str) {\r\n  return str.replace(/\\-(.)/g, (match) => match[1].toUpperCase());\r\n}\r\n","import LIB_ATTR from './globals/attributes';\r\n\r\nimport { get, set, forEach, map, toObject, mapKeys, remove } from './helpers/object';\r\n\r\nimport areEqual from './helpers/equality';\r\nimport { has } from './helpers/common';\r\n\r\nimport StateAccessError from './errors/StateAccessError';\r\nimport StateLookupError from './errors/StateLookupError';\r\nimport BindingNotExistsError from './errors/BindingNotExistsError';\r\n\r\nimport {\r\n  renderChanges,\r\n} from './View';\r\n\r\nimport {\r\n  isEmpty,\r\n  isArray,\r\n  isString,\r\n  isNumber,\r\n  isUndefined,\r\n  isObject,\r\n} from './helpers/checkers';\r\n\r\nimport { removeNode } from './helpers/dom';\r\n\r\nexport {\r\n  createElement,\r\n  createAccessor,\r\n  getOnlyValues,\r\n  startTransaction,\r\n  commitChanges,\r\n};\r\n\r\nconst ELEMENTS = {};\r\nconst STATE = {};\r\nconst CHANGES = { changes: {}, collecting: false };\r\nlet ELEMENT_COUNTER = 1;\r\n\r\nconst VALUE_TYPES = ['attrs', 'style', 'html', 'class', 'value'];\r\n\r\nwindow.ELEMENTS = ELEMENTS\r\nwindow.STATE = STATE;\r\nwindow.CHANGES = CHANGES;\r\n\r\nfunction createElement (componentOpts) {\r\n  const id = ELEMENT_COUNTER++;\r\n  const name = componentOpts.name;\r\n\r\n  const element = ELEMENTS[id] = {\r\n    id,\r\n    state: { [name]: componentOpts.component },\r\n  };\r\n\r\n  STATE[id] = {};\r\n\r\n  setupValueNodesForComponents([id, name]);\r\n\r\n  applyChanges({ [id]: { [name]: false } });\r\n  element.el = STATE[id][name][LIB_ATTR.SELF].el;\r\n  element.el.setAttribute(LIB_ATTR.COMPONENT_TYPE, LIB_ATTR.BASE);\r\n\r\n  return element;\r\n}\r\n\r\nfunction setupValueNodesForComponents (statePath, values) {\r\n  values = values || {};\r\n  const accessor = createAccessor(statePath);\r\n  const component = accessor.component;\r\n  const valuesNode = createValuesNode(component, values);\r\n  set(STATE, accessor.statePath, valuesNode);\r\n\r\n  forEach(component.state, (binding, bindingName) => {\r\n    if (binding.isComponent) {\r\n      setupValueNodesForComponents(statePath.concat(bindingName), values[bindingName]);\r\n    }\r\n\r\n    if (binding.isList && isArray(values[bindingName])) {\r\n      values[bindingName].forEach((el, i) => setupValueNodesForComponents(statePath.concat(bindingName, binding.listItemName, i), el));\r\n    }\r\n  });\r\n\r\n  return valuesNode;\r\n}\r\n\r\nfunction createValuesNode (component, values) {\r\n  values = values || {};\r\n\r\n  const valuesNodes = map(component.state, (binding, bindingName) => {\r\n    const valueNode = binding.isList ? [] : {};\r\n    Object.assign(valueNode, { [LIB_ATTR.SELF]: toObject(VALUE_TYPES, {}) });\r\n\r\n    return VALUE_TYPES.reduce((a, key) => {\r\n      let value;\r\n\r\n      switch (key) {\r\n\r\n        case 'value':\r\n        case 'html':\r\n          value = binding.initValue || ''\r\n\r\n          if (!isUndefined(values[bindingName])) {\r\n            value = values[bindingName]\r\n\r\n          } else if (binding.isList) {\r\n            value = [];\r\n\r\n          } else if (binding.isComponent) {\r\n            value = {};\r\n          }\r\n          break;\r\n\r\n        default:\r\n          value = {};\r\n      }\r\n\r\n      a[key] = value;\r\n\r\n      return a;\r\n    }, valueNode);\r\n  });\r\n\r\n  if (component.isListItem || component.isComponent || component.isList) {\r\n    Object.assign(valuesNodes, { [LIB_ATTR.SELF]: toObject(VALUE_TYPES, {}) });\r\n  }\r\n\r\n  return valuesNodes;\r\n}\r\n\r\nfunction createAccessor (path) {\r\n  const { component, statePath, values } = analyzePath(path);\r\n\r\n  const accessor = {\r\n    component,\r\n    values,\r\n    statePath,\r\n    path,\r\n    up: (level) => moveUpStatePath(level, path.slice()),\r\n    down: (additionalPath) => createAccessor(path.concat(additionalPath)),\r\n    set: (changeObj) => setValues( prepareChangeObject(changeObj), path),\r\n    get: (key) => getValues( getOnlyValues(values), key, path),\r\n    markup: (key) => key ? values[key].el : values[LIB_ATTR.SELF].el,\r\n  }\r\n\r\n  if (values && isArray(values.value)) {\r\n    modifyToArrayAccessor(accessor);\r\n  }\r\n\r\n  return accessor;\r\n}\r\n\r\nfunction prepareChangeObject (changeObj) {\r\n  return map(changeObj, (v) => {\r\n    const forced = isObject(v) && Object.keys(v)[0] === 'force';\r\n\r\n    return {\r\n      value: forced ? v['force'] : v,\r\n      type: 'value',\r\n      force: forced,\r\n    };\r\n  });\r\n}\r\n\r\nfunction analyzePath (path) {\r\n  let component = ELEMENTS[ path[0] ];\r\n  let values = STATE[ path[0] ];\r\n  let statePath = [ path[0] ];\r\n\r\n  for (let i = 1; i < path.length; i++) {\r\n\r\n    component = component.state[ path[i] ];\r\n    values = values[ path[i] ];\r\n    statePath.push(path[i]);\r\n\r\n    if (component.isList && i !== (path.length -1)) {\r\n\r\n      component = component.state[ path[ i + 1 ] ];\r\n      values = values[ path[ i + 2 ] ];\r\n      statePath.push( path[ i + 2 ] );\r\n\r\n      i+=2;\r\n    }\r\n\r\n  }\r\n\r\n  return { component, statePath, values };\r\n}\r\n\r\nfunction startTransaction () {\r\n  const changes = CHANGES.changes;\r\n  CHANGES.changes = {};\r\n  applyChanges(changes);\r\n  CHANGES.collecting = true;\r\n}\r\n\r\nfunction commitChanges () {\r\n  const changes = CHANGES.changes;\r\n  CHANGES.changes = {};\r\n  applyChanges(changes);\r\n}\r\n\r\nfunction applyChanges (changes) {\r\n  const lifeCycleHandlers = renderChanges(changes);\r\n  CHANGES.collecting = true;\r\n  lifeCycleHandlers.forEach((h) => h());\r\n  renderChanges(CHANGES.changes);\r\n  CHANGES.collecting. false;\r\n  CHANGES.changes = {};\r\n}\r\n\r\nfunction setValues (changeValues, statePath, calledDependences) {\r\n  calledDependences = calledDependences || [];\r\n\r\n  const accessor = createAccessor(statePath);\r\n  const changes = [];\r\n\r\n  if (!accessor.values) {\r\n    accessor.values = setupValueNodesForComponents(statePath);\r\n    const start = +statePath.slice(-1)[0];\r\n    changes.push({ path: statePath, details: { [LIB_ATTR.FULL_CHANGE]: { add: { start, end: start + 1 } } } });\r\n  }\r\n\r\n  forEach(changeValues, (change, bindingName) => {\r\n    const changesForValue = setValue(bindingName, change, accessor, calledDependences);\r\n    changes.push.apply(changes, changesForValue);\r\n  });\r\n\r\n  if (changes.length) {\r\n    changes.forEach((change) => set(CHANGES.changes, change.path, change.details))\r\n\r\n    if (CHANGES.collecting) {\r\n      return;\r\n    }\r\n\r\n    commitChanges();\r\n  }\r\n}\r\n\r\nfunction setValue (bindingName, change, accessor, calledDependences) {\r\n  const statePath = accessor.path;\r\n  const component = accessor.component;\r\n  const values = accessor.values;\r\n  bindingName = component.aliases[bindingName] || bindingName;\r\n  const binding = change.isComponent ? component : component.state[bindingName];\r\n\r\n  if (change.type === 'value') {\r\n    if (binding.isList) {\r\n      return setValueForList(binding, change, values[bindingName], statePath);\r\n    }\r\n\r\n    if (isObject(change.value) && binding.isComponent) {\r\n      return setValueForComponent(binding, change, component, statePath)\r\n    }\r\n  }\r\n\r\n  const equal = areEqual(values[bindingName][change.type], change.value);\r\n\r\n  if (!equal || !isEmpty(equal) || change.force) {\r\n    values[bindingName][change.type] = change.value;\r\n\r\n    if (change.type !== 'value') {\r\n      return [{ path: statePath.concat(bindingName), details: { [change.type]: false } }];\r\n    }\r\n\r\n    calledDependences.push(bindingName + ':' + change.type);\r\n\r\n    if (!binding.html) {\r\n      setValues({ [bindingName]: { value: change.value, type: 'html' } }, statePath);\r\n    }\r\n\r\n    const link = component.links[bindingName];\r\n    if (link) {\r\n      setValues({ [link.link]: { value: change.value, type: 'value' } }, statePath.concat(link.component))\r\n    }\r\n\r\n    forEach(binding.dependants, (dependant, dependantKey) => {\r\n      if (has(calledDependences, dependantKey)) {\r\n        return;\r\n      }\r\n\r\n      const isComponent = dependant.name === LIB_ATTR.SELF;\r\n      const dependantBinding = isComponent ? component : component.state[dependant.name];\r\n      const newValue = dependantBinding.evaluate[dependant.type](values, accessor);\r\n      setValues({ [dependant.name]: { value: newValue, type: dependant.type, isComponent } }, statePath, calledDependences);\r\n    });\r\n  }\r\n}\r\n\r\nfunction setValueForList (binding, change, arr, statePath) {\r\n  Object.keys(change.value).forEach((i) => {\r\n    const realChangeValues = mapKeys(change.value[i], (key) => binding.links[key] ? binding.links[key].link : key);\r\n    setValues( prepareChangeObject(realChangeValues), statePath.concat(binding.name, binding.listItemName, i))\r\n  });\r\n\r\n  const keysEquality = areEqual(arr, change.value);\r\n\r\n  return Object.keys(keysEquality).map((idx) => {\r\n    const changeObj = keysEquality[idx];\r\n\r\n    if (changeObj.remove) {\r\n      changeObj.remove = arr.splice(idx, 1)[0];\r\n    }\r\n\r\n    return { path: statePath.concat(binding.name, binding.listItemName, idx), details: { [LIB_ATTR.FULL_CHANGE]: changeObj } };\r\n  });\r\n}\r\n\r\nfunction setValueForComponent (binding, change, component, statePath) {\r\n  const realChangeValues = mapKeys(change.value, (key) => component.links[key] ? component.links[key].link : key);\r\n  setValues( prepareChangeObject(realChangeValues), statePath.concat(binding.name));\r\n}\r\n\r\nfunction getOnlyValues (obj) {\r\n  return map(obj, (bindingValues) => bindingValues['value']);\r\n}\r\n\r\nfunction getValues (values, key, statePath) {\r\n  if (!key) {\r\n    return values;\r\n  }\r\n  const value = values[key];\r\n  return isArray(value) ? createAccessor(statePath.concat(key)) : value;\r\n}\r\n\r\nfunction moveUpStatePath (level, statePath) {\r\n  let newStatePath;\r\n  if (isString(level)) {\r\n    for (let i = statePath.length - 1; i > 0; i--) {\r\n      if (statePath[i] === level) {\r\n        const lastIdx = i + (isNumber( +statePath[ i + 1 ] ) ? 2 : 1);\r\n        newStatePath = statePath.slice(0, lastIdx);\r\n      }\r\n    }\r\n\r\n  } else {\r\n    level = level || 1;\r\n    let lastIdx = statePath.length;\r\n    while (--lastIdx && level--) {\r\n\r\n      if (isNumber(+statePath[lastIdx])) {\r\n        lastIdx--;\r\n      }\r\n    }\r\n\r\n    newStatePath = statePath.slice(0, lastIdx + 1);\r\n  }\r\n\r\n  if (!newStatePath || !newStatePath.length) {\r\n    throw new StateLookupError(level);\r\n  }\r\n\r\n  return createAccessor(newStatePath);\r\n}\r\n\r\nfunction modifyToArrayAccessor (accessor) {\r\n  Object.assign(accessor, {\r\n    get: (num) => createAccessor(accessor.path.concat(accessor.component.listItemName, num)),\r\n\r\n    push: (els) => modifyArray('add', { start: accessor.values.length, els }, accessor),\r\n    unshift: (els) => modifyArray('add', { start: 0, els }, accessor),\r\n    add: (start, els) => modifyArray('add', { start, els }, accessor),\r\n\r\n    pop: (num) => modifyArray('remove', { start: accessor.values.length - (num || 1), num }, accessor),\r\n    shift: (num) => modifyArray('remove', { start: 0, num }, accessor),\r\n    remove: (start, num) => modifyArray('remove', { start, num }, accessor),\r\n\r\n    length: () => accessor.values.length,\r\n    raw: () => accessor.values.slice(),\r\n  });\r\n}\r\n\r\nfunction modifyArray (action, args, accessor) {\r\n  const statePath = accessor.path.concat( accessor.component.listItemName );\r\n  const arr = accessor.values;\r\n  const start = args.start;\r\n  let changeObj = {};\r\n\r\n  switch (action) {\r\n    case 'add':\r\n      changeObj = addToArray(arr, start, args.els, statePath);\r\n      break;\r\n\r\n    case 'remove':\r\n      changeObj = removeFromArray(arr, start, args.num || 1);\r\n      break;\r\n  }\r\n\r\n  forEach(changeObj, (change, idx) => set(CHANGES.changes, statePath.concat(idx, LIB_ATTR.FULL_CHANGE), changeObj[idx][LIB_ATTR.FULL_CHANGE]));\r\n\r\n  if (CHANGES.collecting) {\r\n    return;\r\n  }\r\n\r\n  commitChanges();\r\n}\r\n\r\nfunction addToArray (arr, start, els, statePath) {\r\n  els = isArray(els) ? els : [els];\r\n\r\n  els.forEach((el, i) => {\r\n    arr.splice(i + start, 0, null);\r\n    setValues(prepareChangeObject(el), statePath.concat(i + start));\r\n  });\r\n\r\n  return { [start]: { [LIB_ATTR.FULL_CHANGE]: { add: { start, end: start + els.length } } } };\r\n}\r\n\r\nfunction removeFromArray (arr, start, num) {\r\n  const removed = arr.splice(start, num);\r\n\r\n  return removed.reduce((a, vals, i) => (a[start + i] = { [LIB_ATTR.FULL_CHANGE]: { remove: vals } }) && a, {});\r\n}\r\n","import LIB_ATTR from './globals/attributes';\r\nimport RE from './globals/regexp';\r\n\r\nimport {\r\n  cloneHTMLMarkup,\r\n  collectHTMLNodes,\r\n} from './helpers/dom';\r\n\r\nimport { set, forEach, map, toObject } from './helpers/object';\r\n\r\nimport copy from './helpers/copy';\r\n\r\nimport {\r\n  isArray,\r\n  isFunction,\r\n  isObject,\r\n  isEmpty,\r\n  isDOMElement,\r\n} from './helpers/checkers';\r\n\r\nimport {\r\n  has,\r\n  toCamelCase,\r\n  getShortName,\r\n} from './helpers/common';\r\n\r\nimport {\r\n  getOnlyValues,\r\n} from './State';\r\n\r\nimport {\r\n  createAndAppendStyles,\r\n} from './View';\r\n\r\nimport ComponentRedefineError from './errors/ComponentRedefineError';\r\nimport ScopeNameCollisionError from './errors/ScopeNameCollisionError';\r\n\r\n\r\nconst REACTIVE_FUNCS_TYPES = ['style', 'class', 'value', 'attrs', 'html'];\r\nconst RESERVED_HOOKS_NAMES = ['mount', 'update', 'remove'];\r\nconst DEFAULT_HOOKS = toObject(RESERVED_HOOKS_NAMES, () => () => {});\r\n\r\nexport {\r\n  define,\r\n  analyzeBinding,\r\n  getComponentOpts,\r\n  shortenBindingId,\r\n};\r\n\r\nlet COMPONENT_COUNTER = 0;\r\nconst COMPONENTS = {};\r\nwindow.COMPONENTS = COMPONENTS;\r\n\r\nconst RESERVED_BINDING_NAMES = REACTIVE_FUNCS_TYPES.concat(['events', 'hooks', 'listItem']);\r\n\r\nfunction define (name, markup, bindings, hooks, styles) {\r\n  const args = isObject(name) ? name : { name, markup, bindings, hooks, styles };\r\n\r\n  name = toCamelCase(args.name);\r\n\r\n  if (COMPONENTS[name]) {\r\n    throw new ComponentRedefineError(name);\r\n  }\r\n\r\n  const componentHTMLMarkup = cloneHTMLMarkup(args.markup);\r\n  componentHTMLMarkup.classList.add(args.name);\r\n\r\n  COMPONENT_COUNTER = 0;\r\n\r\n  const component = COMPONENTS[name] = {\r\n    name: name,\r\n    state: {},\r\n    stateId: name,\r\n    statePath: [name],\r\n    hooks: Object.assign({}, DEFAULT_HOOKS, args.hooks),\r\n    stateNames: {},\r\n    markup: componentHTMLMarkup,\r\n    evaluate: {},\r\n    links: {},\r\n    isComponent: true,\r\n    aliases: {},\r\n  };\r\n\r\n  gatherBindingsFromMarkup(componentHTMLMarkup, component);\r\n\r\n  const normalizedOptions = normalizeUserOptions(args.bindings);\r\n  copy(component, normalizedOptions);\r\n\r\n  prepareBindings (component, component.stateId, { statePath: [], links: {}, stateNames: component.stateNames });\r\n\r\n  createAndAppendStyles(args.styles, args.name);\r\n}\r\n\r\nfunction gatherBindingsFromMarkup (componentHTMLMarkup, component) {\r\n  const HTMLNodes = collectHTMLNodes(componentHTMLMarkup, analyzeBinding);\r\n  for (let i = 0; i < HTMLNodes.length; i++) {\r\n    const HTMLNode = HTMLNodes[i];\r\n\r\n    const bindingOpts = analyzeBinding(HTMLNode);\r\n    const binding = createBinding(bindingOpts.name, component, HTMLNode);\r\n\r\n    if (bindingOpts.isComponent) {\r\n      setComponent(binding, bindingOpts);\r\n      HTMLNode.classList.add(LIB_ATTR.PREFIX + binding.id);\r\n    }\r\n\r\n    component.state[binding.name] = binding;\r\n    binding.markup.removeAttribute(LIB_ATTR.TEMPLATE_BINDING);\r\n    binding.markup.removeAttribute(LIB_ATTR.TEMPLATE_LIST_BINDING);\r\n    binding.markup.classList.add(LIB_ATTR.PREFIX + binding.id, binding.name);\r\n\r\n    if (bindingOpts.isList) {\r\n      i++;\r\n      modifyToListBinding(binding, HTMLNode.children[0]);\r\n      gatherBindingsFromMarkup(HTMLNode.children[0], binding);\r\n    }\r\n  }\r\n\r\n  return component;\r\n}\r\n\r\nfunction setComponent (componentBinding, subComponentOpts) {\r\n  const stateNames = Object.assign(componentBinding.stateNames, subComponentOpts.component.stateNames);\r\n  let stateId = subComponentOpts.component.name + 'x' + COMPONENT_COUNTER++;\r\n\r\n  if (subComponentOpts.stateName) {\r\n    if (stateNames[subComponentOpts.stateName]) {\r\n      throw new ScopeNameCollisionError(subComponentOpts.stateName);\r\n    }\r\n\r\n    stateId = subComponentOpts.stateName;\r\n    componentBinding.stateNames[stateId] = true;\r\n  }\r\n\r\n  copy(componentBinding, subComponentOpts.component);\r\n\r\n  return Object.assign( componentBinding, {\r\n    id: stateId,\r\n    stateId,\r\n    name: stateId,\r\n    stateName: subComponentOpts.stateName,\r\n    statePath: componentBinding.statePath.concat(stateId),\r\n    markup: subComponentOpts.component.markup.cloneNode(true),\r\n    isComponent: true,\r\n    stateNames,\r\n    _links: Object.assign({}, subComponentOpts.links),\r\n    aliases: Object.assign({}, subComponentOpts.revLinks),\r\n  });\r\n}\r\n\r\nfunction prepareBindings (component, currentStateId, parentComponent) {\r\n  const componentWrapper = document.createElement('div');\r\n  componentWrapper.appendChild(component.markup);\r\n  component.statePath = parentComponent.statePath.concat(component.stateId);\r\n  component.stateNames = parentComponent.stateNames;\r\n\r\n  const subComponents = [];\r\n\r\n  forEach(component.state, (binding, bindingName) => {\r\n    const oldBindingId = binding.id;\r\n    const newBindingId = currentStateId + LIB_ATTR.STATE_DELIMITER + bindingName;\r\n    const shortId = shortenBindingId(newBindingId);\r\n\r\n    if (binding.markup) {\r\n      const bindingNode = componentWrapper.querySelector('.' + LIB_ATTR.PREFIX + oldBindingId);\r\n      bindingNode.setAttribute(LIB_ATTR.BINDING_ID, shortId);\r\n      bindingNode.classList.remove(LIB_ATTR.PREFIX + oldBindingId);\r\n      bindingNode.classList.add(LIB_ATTR.PREFIX + newBindingId);\r\n    }\r\n\r\n    Object.assign(binding, {\r\n      statePath: component.statePath.slice(),\r\n      hooks: Object.assign({}, DEFAULT_HOOKS, binding.hooks),\r\n      id: newBindingId,\r\n      shortId,\r\n    });\r\n\r\n    prepareReactiveFuncs(binding, component);\r\n\r\n    if (binding.isList) {\r\n      binding.statePath.push(bindingName);\r\n      binding.stateNames = component.stateNames;\r\n      binding.listItemName = Object.keys(binding.state)[0];\r\n\r\n      const listItemComponent = binding.state[binding.listItemName];\r\n      copy(listItemComponent, binding.listItem);\r\n\r\n      prepareBindings (listItemComponent, newBindingId + LIB_ATTR.STATE_DELIMITER + binding.listItemName, binding);\r\n      return;\r\n    }\r\n\r\n    if (binding.isComponent) {\r\n      subComponents.push(binding);\r\n    }\r\n  });\r\n\r\n  prepareReactiveFuncs(component, component);\r\n  setupComponentsLinks(component, parentComponent);\r\n  component.template = component.markup.cloneNode(true);\r\n\r\n  subComponents.forEach((subComponent) => {\r\n    prepareBindings (subComponent, currentStateId + LIB_ATTR.STATE_DELIMITER + subComponent.stateId, component);\r\n  });\r\n}\r\n\r\nfunction prepareReactiveFuncs (binding, componentData) {\r\n  REACTIVE_FUNCS_TYPES.forEach((type) => {\r\n    const reactiveFunc = binding[type];\r\n    if (!reactiveFunc) {\r\n      return;\r\n    }\r\n\r\n    binding.evaluate[type] = prepareReactiveFunc(binding, type, reactiveFunc, componentData)\r\n  });\r\n}\r\n\r\nfunction prepareReactiveFunc (binding, type, reactiveFunc, componentData) {\r\n  const dependenciesNames = getDependenciesNames(reactiveFunc);\r\n\r\n  dependenciesNames.forEach((dependencyName) => {\r\n    if (isEmpty(componentData.state[dependencyName])) {\r\n      componentData.state[dependencyName] = createBinding(dependencyName, componentData);\r\n    }\r\n\r\n    let name = binding.name;\r\n    if (binding === componentData) {\r\n      name = LIB_ATTR.SELF;\r\n    }\r\n\r\n    componentData.state[dependencyName].dependants[ name + ':' + type ] = { name, type };\r\n  });\r\n\r\n  return (values, accessor) => compute (reactiveFunc, values, accessor);\r\n}\r\n\r\nfunction getDependenciesNames(func) {\r\n  const funcParams = getParamNames(func);\r\n  const valuesObjRegExp =  new RegExp('\\\\' + funcParams[0] + '\\\\.(\\\\D[^\\\\s\\\\W]+)', 'g');\r\n  const dependenciesNames = [];\r\n  const funcStr = func.toString();\r\n  let dependencyName;\r\n  while (dependencyName = valuesObjRegExp.exec(funcStr)) {\r\n    dependenciesNames.push(dependencyName[1]);\r\n  }\r\n  return dependenciesNames;\r\n}\r\n\r\nfunction getParamNames(func) {\r\n  const funcStrWithoutComments = func.toString().replace(RE.STRIP_COMMENTS, '');\r\n  const paramsStr = funcStrWithoutComments.slice(\r\n    funcStrWithoutComments.indexOf('(') +1,\r\n    funcStrWithoutComments.indexOf(')')\r\n  );\r\n  return paramsStr.match(RE.ARGUMENT_NAMES) || [];\r\n}\r\n\r\nfunction compute (func, valuesObj, accessor) {\r\n  return func.call(this, getOnlyValues(valuesObj), accessor);\r\n}\r\n\r\nfunction setupComponentsLinks (component, parentComponent) {\r\n  Object.assign(\r\n    parentComponent.links,\r\n    map(component.aliases, (k, v) => ({ link: k, component: component.stateId }))\r\n  );\r\n}\r\n\r\nfunction normalizeUserOptions (optionsObj, parentKey, parentObj) {\r\n\r\n  if (isFunction (optionsObj)) {\r\n    return set(parentObj.state, [parentKey], { class: optionsObj });\r\n  }\r\n\r\n  if (isArray(optionsObj)) {\r\n\r\n    if (optionsObj.length > 1) {\r\n      optionsObj.forEach((option) => normalizeUserOptions (option, parentKey, parentObj));\r\n      return;\r\n    }\r\n\r\n    if (isFunction(optionsObj[0])) {\r\n      return set(parentObj.state, [parentKey], { value: optionsObj[0], listeners: [], dependants: {} });\r\n    }\r\n    if (isObject(optionsObj[0])) {\r\n      return set(parentObj.state, [parentKey], { events: optionsObj[0] });\r\n    }\r\n  }\r\n\r\n  for (let key in optionsObj) {\r\n    const value = optionsObj[key];\r\n\r\n    if (!has(RESERVED_BINDING_NAMES, key)) {\r\n      if (!optionsObj.state) {\r\n        optionsObj.state = {};\r\n      }\r\n\r\n      const basicBinding = createBinding(key);\r\n      optionsObj.state[key] = isObject(value) ? Object.assign(basicBinding, value) : basicBinding;\r\n      delete optionsObj[key];\r\n      normalizeUserOptions(value, key, optionsObj);\r\n      continue;\r\n    }\r\n\r\n    if (key === 'listItem') {\r\n      normalizeUserOptions(value, key, optionsObj);\r\n    }\r\n  }\r\n  return optionsObj;\r\n}\r\n\r\nfunction analyzeBinding (el) {\r\n  if (isComponent(el)) {\r\n    return getComponentOpts(el);\r\n  }\r\n\r\n  if (!el.getAttribute) {\r\n    return null;\r\n  }\r\n\r\n  let name = el.getAttribute(LIB_ATTR.TEMPLATE_BINDING);\r\n\r\n  if (name) {\r\n    return { name: name.trim() };\r\n  }\r\n\r\n  name = el.getAttribute(LIB_ATTR.TEMPLATE_LIST_BINDING);\r\n\r\n  if (name) {\r\n    return { name: name.trim(), isList: true };\r\n  }\r\n}\r\n\r\nfunction isComponent (el) {\r\n  const tagName = el.tagName && el.tagName.toLowerCase();\r\n  return tagName && COMPONENTS[ toCamelCase(tagName) ];\r\n}\r\n\r\nfunction getComponentOpts (obj) {\r\n  const name = toCamelCase( obj.tagName.toLowerCase() );\r\n  const component = getComponentByName(name);\r\n  const links = {};\r\n  const revLinks = {};\r\n  let stateName = null;\r\n\r\n  Array.prototype.slice.call(obj.attributes)\r\n    .forEach((attr) => {\r\n\r\n      if (attr.name === LIB_ATTR.STATE_NAME) {\r\n        stateName = attr.value;\r\n        return;\r\n      }\r\n\r\n      const innerLink = toCamelCase(attr.name);\r\n      links[innerLink] = attr.value;\r\n      revLinks[attr.value] = innerLink;\r\n    });\r\n\r\n  return {\r\n    component,\r\n    links: links,\r\n    revLinks: revLinks,\r\n    stateName,\r\n    name,\r\n    isComponent: true,\r\n  };\r\n}\r\n\r\nfunction getComponentByName (name) {\r\n  const component = COMPONENTS[ toCamelCase(name) ];\r\n\r\n  if (!component) {\r\n    throw new ComponentNotExistsError(name);\r\n  }\r\n\r\n  return component;\r\n}\r\n\r\nfunction createBinding (name, component, el) {\r\n  const componentOpts = (component) ? {\r\n    id: component.stateId + LIB_ATTR.STATE_DELIMITER + name,\r\n    statePath: component.statePath,\r\n    stateNames: component.stateNames,\r\n    isListItem: component.isList,\r\n    stateId: name,\r\n  } : {};\r\n\r\n  const elOpts = (el) ? {\r\n    initValue: el.value || el.innerHTML\r\n  } : {};\r\n\r\n  return Object.assign({\r\n    name,\r\n    listeners: [],\r\n    markup: el,\r\n    dependants: {},\r\n    events: {},\r\n    evaluate: {},\r\n    links: {},\r\n    state: {},\r\n    aliases: {},\r\n\r\n  }, componentOpts, elOpts);\r\n}\r\n\r\nfunction modifyToListBinding (binding, itemMarkup) {\r\n  return Object.assign(binding, {\r\n    isList: true,\r\n    markup: itemMarkup,\r\n    state: {},\r\n  });\r\n}\r\n\r\nfunction shortenBindingId (id) {\r\n  return id\r\n  .split(LIB_ATTR.STATE_DELIMITER)\r\n  .map((el) => getShortName(el))\r\n  .join(LIB_ATTR.STATE_DELIMITER);\r\n}\r\n","import LIB_ATTR from './globals/attributes';\r\nimport { toDashCase, has } from './helpers/common';\r\nimport { forEach } from './helpers/object';\r\n\r\nimport { isNumber } from './helpers/checkers'\r\n\r\nimport {\r\n  createAccessor,\r\n  addMarkup,\r\n  getMarkup,\r\n  removeMarkup,\r\n  removeComponent,\r\n} from './State';\r\n\r\nimport {\r\n  replaceNodes,\r\n  removeNode,\r\n} from './helpers/dom';\r\n\r\nexport {\r\n  createAndAppendStyles,\r\n  renderChanges\r\n};\r\n\r\nconst render = {\r\n  html: applyMarkup,\r\n  class: applyClasses,\r\n  style: applyStyles,\r\n  attrs: applyAttributes,\r\n}\r\n\r\nconst LIFE_CYCLE_HANDLERS = { list: [] };\r\n\r\nfunction renderChanges (changes) {\r\n  console.log(changes);\r\n\r\n  LIFE_CYCLE_HANDLERS.list = [];\r\n\r\n  forEach(changes, (componentChanges, elementId) => {\r\n    const componentId = Object.keys(componentChanges)[0]\r\n    const componentAccessor = createAccessor([elementId, componentId]);\r\n    applyMarkup(componentAccessor.component, componentAccessor.values, [elementId, componentId], componentChanges[componentId]);\r\n  });\r\n\r\n  return LIFE_CYCLE_HANDLERS.list;\r\n}\r\n\r\nfunction applyMarkup (component, value, statePath, changes) {\r\n  if (!component.markup) {\r\n    return;\r\n  }\r\n\r\n  if (component.isList) {\r\n    return renderList(component, value, statePath, changes);\r\n  }\r\n\r\n  if (component.isComponent) {\r\n    return renderComponent(component, value, statePath, changes);\r\n  }\r\n\r\n  if (component.markup.tagName === 'INPUT') {\r\n    component.markup.value = value || '';\r\n    return;\r\n  }\r\n\r\n  component.markup.innerHTML = value || '';\r\n\r\n  return component;\r\n}\r\n\r\nfunction renderComponent (component, value, statePath, changes) {\r\n  if (changes) {\r\n    return updateComponent(component, value, statePath, changes);\r\n  }\r\n\r\n  return drawComponent(value, statePath);\r\n}\r\n\r\nfunction drawComponent (values, statePath) {\r\n  const accessor = createAccessor(statePath);\r\n  const component = accessor.component;\r\n\r\n  const itemWrapper = document.createElement('div');\r\n  const itemMarkup = component.template.cloneNode(true);\r\n  values[LIB_ATTR.SELF].el = itemMarkup;\r\n  itemWrapper.appendChild(itemMarkup);\r\n\r\n  itemMarkup.setAttribute(LIB_ATTR.COMPONENT_TYPE, (component.isListItem) ? LIB_ATTR.ITEM : LIB_ATTR.COMPONENT);\r\n\r\n  forEach(render, (renderFunc, renderType) => {\r\n    if (component[renderType]) {\r\n      renderFunc({ markup: itemMarkup }, values[LIB_ATTR.SELF][renderType]);\r\n    }\r\n  });\r\n\r\n  if (!component.markup.children.length) {\r\n    const firstBinding = Object.keys(component.state)[0];\r\n    applyMarkup({ markup: itemMarkup }, values[firstBinding]['html']);\r\n  }\r\n\r\n  forEach(component.state, (binding, bindingName) => {\r\n    if (!binding.markup) {\r\n      return;\r\n    }\r\n\r\n    const bindingNode = itemWrapper.querySelector('.' + LIB_ATTR.PREFIX + binding.id);\r\n    bindingNode.classList.remove(LIB_ATTR.PREFIX + binding.id);\r\n\r\n    if (binding.isComponent) {\r\n      const childStatePath = statePath.concat(bindingName);\r\n      const childMarkup = drawComponent(values[bindingName], childStatePath);\r\n      replaceNodes(bindingNode, childMarkup);\r\n      return;\r\n    }\r\n\r\n    if (binding.isList) {\r\n      values[bindingName][LIB_ATTR.SELF].el = bindingNode;\r\n      renderList(binding, values[bindingName], statePath.concat(bindingName));\r\n      return;\r\n    }\r\n\r\n    values[bindingName].el = bindingNode;\r\n\r\n    forEach(render, (renderFunc, renderType) => {\r\n      if (renderType === 'html' && binding.html === null || binding.markup.children.length) {\r\n        return;\r\n      }\r\n      renderFunc({ markup: bindingNode }, values[bindingName][renderType], statePath);\r\n    });\r\n  });\r\n\r\n  LIFE_CYCLE_HANDLERS.list.push(() => component.hooks.mount(itemMarkup, accessor.get(), accessor, statePath.slice(-1)[0]));\r\n\r\n  return itemMarkup;\r\n}\r\n\r\nfunction updateComponent (component, values, statePath, changes) {\r\n  const itemIndex = statePath.slice(-1)[0];\r\n  const itemAccessor = createAccessor(statePath);\r\n  const componentMarkup = values[LIB_ATTR.SELF].el;\r\n\r\n  forEach(changes, (change, bindingName) => {\r\n\r\n    if (bindingName === LIB_ATTR.SELF) {\r\n\r\n      for (let changeType in change) {\r\n        render[changeType]({ markup: componentMarkup }, values[LIB_ATTR.SELF][changeType]);\r\n      }\r\n      return;\r\n    }\r\n\r\n    const binding = component.state[bindingName];\r\n    const statePathToBinding = statePath.concat(bindingName);\r\n\r\n    if (binding.isComponent || binding.isList) {\r\n      applyMarkup(binding, values[bindingName], statePathToBinding, changes[bindingName]);\r\n      return;\r\n    }\r\n\r\n    const el = values[bindingName].el\r\n\r\n    for (let changeType in change) {\r\n      const newValue = values[bindingName][changeType];\r\n      render[changeType]({ markup: el }, newValue);\r\n\r\n      LIFE_CYCLE_HANDLERS.list.push(() => binding.hooks.update(el, newValue, itemAccessor, itemIndex));\r\n    }\r\n  });\r\n\r\n  LIFE_CYCLE_HANDLERS.list.push(() => component.hooks.update(componentMarkup, itemAccessor.get(), itemAccessor, itemIndex));\r\n}\r\n\r\nfunction renderList (listComponent, itemsValues, statePath, changes) {\r\n  if (changes) {\r\n    return updateList(listComponent, itemsValues, statePath, changes);\r\n  }\r\n\r\n  const listFragment = buildList(listComponent, itemsValues, statePath);\r\n\r\n  const listNode = itemsValues[LIB_ATTR.SELF].el;\r\n  const parentNode = listNode.parentNode;\r\n  const nextNode = listNode.nextElementSibling;\r\n  removeNode(listNode);\r\n\r\n  listNode.setAttribute(LIB_ATTR.COMPONENT_TYPE, LIB_ATTR.LIST);\r\n  listNode.innerHTML = '';\r\n  listNode.appendChild(listFragment);\r\n\r\n  parentNode.insertBefore(listNode, nextNode);\r\n}\r\n\r\nfunction buildList (listComponent, itemsValues, statePath, range) {\r\n  const start = range ? range.start : 0;\r\n  const end = range ? range.end : (itemsValues.length + 1);\r\n\r\n  const listFragment = document.createDocumentFragment();\r\n  itemsValues\r\n    .slice(start, end)\r\n    .forEach((itemValue, itemIndex) => {\r\n      const newItemIndex = +start + itemIndex;\r\n      const statePathToItem = statePath.concat([listComponent.listItemName, newItemIndex]);\r\n      const listItemMarkup = drawComponent(itemValue, statePathToItem);\r\n\r\n      listItemMarkup.setAttribute(LIB_ATTR.ITEM_INDEX, newItemIndex);\r\n\r\n      listFragment.appendChild(listItemMarkup);\r\n    });\r\n\r\n  return listFragment;\r\n}\r\n\r\nfunction updateList (listBinding, itemsValues, statePath, changes) {\r\n  const listNode = itemsValues[LIB_ATTR.SELF].el;\r\n  let removedCount = 0;\r\n  let end = 0;\r\n\r\n  for (let changeType in changes) {\r\n    if (has(Object.keys(render), changeType)) {\r\n      render[changeType]({ markup: listNode }, itemsValues[changeType]);\r\n    }\r\n  }\r\n\r\n  const itemChanges = changes[listBinding.listItemName] || {};\r\n\r\n  forEach(itemChanges, (change, i) => {\r\n    const statePathToItem = statePath.concat(listBinding.listItemName, i);\r\n    const itemAccessor = createAccessor(statePathToItem);\r\n\r\n    if (!change[LIB_ATTR.FULL_CHANGE]) {\r\n      updateComponent(itemAccessor.component, itemsValues[i], statePathToItem, change);\r\n      return;\r\n    }\r\n\r\n    if (change[LIB_ATTR.FULL_CHANGE].add && i >= end) {\r\n      const start = change[LIB_ATTR.FULL_CHANGE].add.start;\r\n      end = change[LIB_ATTR.FULL_CHANGE].add.end;\r\n\r\n      fixIndexes(listNode, start, end - start);\r\n      const listFragment = buildList(listBinding, itemsValues, statePath, { start, end });\r\n\r\n      if (end === itemsValues.length) {\r\n        listNode.appendChild(listFragment);\r\n        return;\r\n      }\r\n\r\n      listNode.insertBefore(listFragment, listNode.children[start]);\r\n      return;\r\n    }\r\n\r\n    if (change[LIB_ATTR.FULL_CHANGE].remove) {\r\n      const values = change[LIB_ATTR.FULL_CHANGE].remove;\r\n      const node = values[LIB_ATTR.SELF].el;\r\n\r\n      removeNode(node);\r\n      fixIndexes(listNode, i - removedCount++, -1);\r\n\r\n      const hooks = listBinding.state[listBinding.listItemName].hooks;\r\n      LIFE_CYCLE_HANDLERS.list.push(() => hooks.remove(node, values, itemAccessor, i));\r\n      return;\r\n    }\r\n  });\r\n}\r\n\r\nfunction fixIndexes (listNode, start, diff) {\r\n  const itemsNodes = Array.prototype.slice.call(listNode.children, start);\r\n\r\n  itemsNodes.forEach((itemNode) => {\r\n    const prevIdx = itemNode.getAttribute(LIB_ATTR.ITEM_INDEX);\r\n    const newIdx = +prevIdx + diff;\r\n\r\n    itemNode.setAttribute(LIB_ATTR.ITEM_INDEX, newIdx);\r\n  });\r\n}\r\n\r\nfunction applyAttributes (binding, attributes) {\r\n  Object.assign(binding.markup, attributes);\r\n}\r\n\r\nfunction applyClasses (binding, classes) {\r\n  for (let className in classes) {\r\n    if (className) {\r\n      if (classes[className]) {\r\n        binding.markup.classList.add(className);\r\n      } else {\r\n        binding.markup.classList.remove(className);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction applyStyles (binding, styles) {\r\n  Object.assign( binding.markup.style, normalizeStyles(styles) );\r\n}\r\n\r\nfunction createAndAppendStyles (styleObj, componentName) {\r\n  let styleStr = '';\r\n  for (let selector in styleObj) {\r\n    const styles = styleObj[selector];\r\n    selector = selector.split(',').map((s) => '.' + componentName + ' ' + s).join(',');\r\n    styleStr += selector + '{';\r\n    normalizeStyles(styles)\r\n    for (let attr in styles) {\r\n      const value = styles[attr];\r\n      styleStr += toDashCase(attr) + ':' + value + ';';\r\n    }\r\n    styleStr += '}';\r\n  }\r\n  const styleEl = document.createElement('style');\r\n  styleEl.appendChild( document.createTextNode(styleStr) );\r\n  document.head.appendChild(styleEl);\r\n}\r\n\r\nfunction normalizeStyles (styles) {\r\n  for (let attr in styles) {\r\n    if (isNumber(styles[attr])) {\r\n      styles[attr] = styles[attr] + 'px';\r\n    }\r\n  }\r\n  return styles;\r\n}\r\n","import { define } from './Definition';\r\nimport { apply } from './Production';\r\n\r\nmodule.exports = {\r\n  define,\r\n  apply,\r\n};\r\n","const STRIP_COMMENTS = /(\\/\\/.*$)|(\\/\\*[\\s\\S]*?\\*\\/)|(\\s*=[^,\\)]*(('(?:\\\\'|[^'\\r\\n])*')|(\"(?:\\\\\"|[^\"\\r\\n])*\"))|(\\s*=[^,\\)]*))/mg;\r\nconst ARGUMENT_NAMES = /([^\\s,]+)/g;\r\n\r\nexport default {\r\n  STRIP_COMMENTS,\r\n  ARGUMENT_NAMES,\r\n};\r\n","export default class ComponentNotExistsError extends Error {\r\n  constructor (name) {\r\n    super();\r\n    this.message = \"Trying to retrieve component by name '\" + name + \"' that doesn't exist.\"\r\n  }\r\n}\r\n","import {\r\n  isUndefined,\r\n  isArray,\r\n  isDOMElement,\r\n  isObject,\r\n} from './checkers';\r\n\r\nexport default copy;\r\n\r\nfunction copy (destination, source) {\r\n  if (!destination) {\r\n    return copy ({}, source);\r\n  }\r\n\r\n  for (let key in source) {\r\n\r\n    if (isUndefined(source[key])) {\r\n      continue;\r\n    }\r\n\r\n    if (source.hasOwnProperty(key) && isObject(source[key])) {\r\n      if (!destination[key]) {\r\n        destination[key] = {};\r\n      }\r\n      copy(destination[key], source[key]);\r\n      continue;\r\n    }\r\n\r\n    if (isArray(source[key])) {\r\n      if (!destination[key]) {\r\n        destination[key] = [];\r\n      }\r\n      copyArray(destination[key], source[key]);\r\n      continue;\r\n    }\r\n\r\n    if (isDOMElement(source[key])) {\r\n      destination[key] = source[key].cloneNode(true);\r\n      continue;\r\n    }\r\n\r\n    destination[key] = source[key];\r\n  }\r\n\r\n  return destination;\r\n};\r\n\r\nfunction copyArray (destination, source) {\r\n  for (let i = 0; i < source.length; i++) {\r\n    if (isObject(source[i])) {\r\n      destination[i] = destination[i] || {};\r\n      copy(destination[i], source[i]);\r\n      continue;\r\n    }\r\n\r\n    if (isArray(source[i])) {\r\n      destination[i] = destination[i] || [];\r\n      copyArray(destination[i], source[i]);\r\n      continue;\r\n    }\r\n\r\n    destination[i] = source[i];\r\n  }\r\n\r\n  return destination;\r\n};\r\n","import {\r\n  isArray,\r\n  isObject,\r\n  isUndefined,\r\n} from './checkers';\r\n\r\nexport default areEqual;\r\n\r\nfunction areEqual (first, second) {\r\n  if (isUndefined(first) || isUndefined(second)) {\r\n    return false;\r\n  }\r\n\r\n  const parentNode = { childNode: {} };\r\n\r\n  if (isArray(second)) {\r\n    checkKeysEquality(\r\n      first ? first.map(el => el) : [],\r\n      second.map(el => el),\r\n      parentNode\r\n    );\r\n\r\n  } else if (isObject(second)) {\r\n    checkKeysEquality(first, second, parentNode);\r\n\r\n  } else {\r\n    return first === second;\r\n\r\n  }\r\n\r\n  return parentNode.childNode;\r\n}\r\n\r\nfunction checkKeysEquality (first, second, parentNode) {\r\n  for (let key in second) {\r\n\r\n    if (isArray(first)) {\r\n      if (isUndefined(first[key])) {\r\n        parentNode.childNode[key] = { add: true };\r\n      }\r\n      continue;\r\n    }\r\n\r\n    if (first[key] !== second[key]) {\r\n      parentNode.childNode[key] = false;\r\n    }\r\n  }\r\n\r\n  for (let key in first) {\r\n\r\n    if (isArray(first)) {\r\n      if (isUndefined(second[key])) {\r\n        parentNode.childNode[key] = { remove: true };\r\n      }\r\n      continue;\r\n    }\r\n\r\n    if (first[key] !== second[key]) {\r\n      parentNode.childNode[key] = false;\r\n    }\r\n  }\r\n\r\n  return parentNode;\r\n}\r\n","export default class StateAccessError extends Error {\r\n  constructor (path) {\r\n    super();\r\n    this.message = \"Unable to access state on a path '\" + path.join(' -> ') +  \"' because it doesn't exist\"\r\n  }\r\n}\r\n","import { isNumber } from '../helpers/checkers';\r\n\r\nexport default class StateLookupError extends Error {\r\n  constructor (level) {\r\n    super();\r\n\r\n    let additionalInfo;\r\n    if (isNumber(level)) {\r\n      additionalInfo = level + \" exceeds number of states in the chain.\" \r\n    } else {\r\n      additionalInfo = \"'\" + level + \"' user statename doesn't exist.\"\r\n    }\r\n\r\n    this.message = \"Unable to reach to the '\" + level + \"' state level. \" + additionalInfo;\r\n  }\r\n}\r\n","export default class BindingNotExistsError extends Error {\r\n  constructor (name) {\r\n    super();\r\n    this.message = \"Unable to access value of '\" + name + \"' binding because it didn't exist and probably wasn't declared.\"\r\n  }\r\n}\r\n","export default class ComponentRedefineError extends Error {\r\n  constructor (name) {\r\n    super();\r\n    this.message = \"Trying to redefine existing component: '\" + name + \"'\";\r\n  }\r\n}\r\n","export default class ScopeNameCollisionError extends Error {\r\n  constructor (name) {\r\n    super();\r\n    this.message = \"Trying to assign a name '\" + name + \"' to a state that already exists in the chain.\";\r\n  }\r\n}\r\n","import {\r\n  replaceNodes,\r\n  collectHTMLNodes,\r\n} from './helpers/dom'\r\n\r\nimport {\r\n  getComponentOpts,\r\n  analyzeBinding,\r\n} from './Definition';\r\n\r\nimport { setupEventHandlers } from './EventHandler';\r\n\r\nimport { createElement } from './State';\r\n\r\nexport { apply };\r\n\r\n\r\nfunction apply (rootElementSelector) {\r\n  const rootElement = document.querySelector(rootElementSelector);\r\n  const HTMLNodes = collectHTMLNodes(rootElement, analyzeBinding);\r\n\r\n  HTMLNodes.forEach((HTMLNode) => {\r\n    const componentOpts = getComponentOpts(HTMLNode);\r\n    const element = setupElement(componentOpts);\r\n\r\n    replaceNodes(HTMLNode, element.el);\r\n  });\r\n}\r\n\r\nfunction setupElement (componentOpts) {\r\n  const element = createElement(componentOpts);\r\n  setupEventHandlers(element);\r\n  return element;\r\n}\r\n","import LIB_ATTR from './globals/attributes';\r\n\r\nimport { forEach } from './helpers/object';\r\nimport { getRealName } from './helpers/common';\r\n\r\nimport {\r\n  createAccessor,\r\n  startTransaction,\r\n  commitChanges,\r\n} from './State';\r\n\r\nexport {\r\n  setupEventHandlers\r\n};\r\n\r\nfunction setupEventHandlers (element) {\r\n  const eventHandlers = {};\r\n  gatherAllEventHandlers(element, eventHandlers);\r\n\r\n  const markup = element.el;\r\n  for (let eventName in eventHandlers) {\r\n    markup.addEventListener(eventName, (e) => executeAllCallbacksInList(e, eventHandlers[eventName], element));\r\n  }\r\n}\r\n\r\nfunction gatherAllEventHandlers (component, gatheredHandlers) {\r\n  gatherEventHandlers (component, gatheredHandlers);\r\n\r\n  if (component.state) {\r\n    forEach(component.state, (binding) => gatherAllEventHandlers(binding, gatheredHandlers));\r\n  }\r\n}\r\n\r\nfunction gatherEventHandlers (binding, gatheredHandlers) {\r\n  if (!binding.events) {\r\n    return;\r\n  }\r\n\r\n  for (let eventName in binding.events) {\r\n    if (!gatheredHandlers[eventName]) {\r\n      gatheredHandlers[eventName] = {};\r\n    }\r\n    gatheredHandlers[eventName][binding.shortId] = binding.events[eventName];\r\n  }\r\n}\r\n\r\nfunction executeAllCallbacksInList (e, eventHandlers, element) {\r\n  decorateEvent(e);\r\n  startTransaction();\r\n  \r\n  let curHTMLNode = e.target;\r\n  while (curHTMLNode !== element.el.parentNode) {\r\n    const bindingId = curHTMLNode.getAttribute(LIB_ATTR.BINDING_ID);\r\n    const eventHandler = eventHandlers[bindingId];\r\n\r\n    if (eventHandler) {\r\n      const indexlessStatePath = bindingId.split(LIB_ATTR.STATE_DELIMITER);\r\n      const statePathToItem = getStatePathToItem(curHTMLNode, indexlessStatePath);\r\n      const accessorToData = createAccessor([element.id].concat(statePathToItem));\r\n\r\n      eventHandler.call(this, e, curHTMLNode, accessorToData, +statePathToItem.slice(-1)[0]);\r\n\r\n      if (e.propagationStopped) {\r\n        break;\r\n      }\r\n    }\r\n    curHTMLNode = curHTMLNode.parentNode;\r\n  }\r\n\r\n  commitChanges();\r\n}\r\n\r\nfunction decorateEvent (e) {\r\n  const stopPropagation = e.stopPropagation.bind(e);\r\n  e.stopPropagation = () => {\r\n    e.propagationStopped = true;\r\n    stopPropagation();\r\n  }\r\n}\r\n\r\nfunction getStatePathToItem (el, indexlessStatePath) {\r\n  if (el.getAttribute(LIB_ATTR.COMPONENT_TYPE) !== LIB_ATTR.LIST) {\r\n    indexlessStatePath.pop();\r\n  }\r\n\r\n  const statePath = [];\r\n  let curEl = el;\r\n  let elType;\r\n\r\n  while (elType !== LIB_ATTR.BASE) {\r\n    elType = curEl.getAttribute(LIB_ATTR.COMPONENT_TYPE);\r\n\r\n    switch (elType) {\r\n      case LIB_ATTR.ITEM:\r\n        statePath.unshift( curEl.getAttribute(LIB_ATTR.ITEM_INDEX) );\r\n\r\n      case LIB_ATTR.BASE:\r\n      case LIB_ATTR.COMPONENT:\r\n      case LIB_ATTR.LIST:\r\n        statePath.unshift( getRealName(indexlessStatePath.pop() ) );\r\n    }\r\n\r\n    curEl = curEl.parentNode;\r\n  }\r\n\r\n  return statePath;\r\n}\r\n"],"sourceRoot":""}